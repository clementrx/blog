serie_title = 'Breaking Bad'
# Seasons
s = 5
# Tv show code
code = 'tt0903747'
# setup dataframe
table = data.frame()
for(i in 1:s){
url = paste0("https://www.imdb.com/title/",code,"/episodes?season=",i)
while(TRUE){
dl_file <- try(download.file(as.character(url), destfile = "temp.html", quiet=TRUE),
silent=TRUE)
if(!is(dl_file, 'try-error')) break
}
html_page <- read_html("temp.html")
saison = i
episode <- html_page %>%
html_nodes("#episodes_content strong a") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
note <- html_page %>%
html_nodes(".ipl-rating-star.small .ipl-rating-star__rating") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
vote <- html_page %>%
html_nodes(".ipl-rating-star__total-votes") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
date <- html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "") %>%
dmy()
temp_table <- as.data.frame(cbind(saison, episode, note, vote, date))
table <- rbind(table,temp_table)
file.remove('temp.html')
}
View(table)
html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "") %>%
dmy()
# Tv show title
serie_title = 'Breaking Bad'
# Seasons
s = 5
# Tv show code
code = 'tt0903747'
# setup dataframe
table = data.frame()
i = 1
url = paste0("https://www.imdb.com/title/",code,"/episodes?season=",i)
while(TRUE){
dl_file <- try(download.file(as.character(url), destfile = "temp.html", quiet=TRUE),
silent=TRUE)
if(!is(dl_file, 'try-error')) break
}
html_page <- read_html("temp.html")
saison = i
episode <- html_page %>%
html_nodes("#episodes_content strong a") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
note <- html_page %>%
html_nodes(".ipl-rating-star.small .ipl-rating-star__rating") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
vote <- html_page %>%
html_nodes(".ipl-rating-star__total-votes") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
date <- html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "") %>%
dmy()
date
temp_table <- as.data.frame(cbind(saison, episode, note, vote, date))
temp_table
date <- html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "") %>%
dmy() %>%
as.Date()
temp_table <- as.data.frame(cbind(saison, episode, note, vote, date))
temp_table
str(date)
date <- html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "") %>%
dmy() %>%
as.character()
temp_table <- as.data.frame(cbind(saison, episode, note, vote, date))
table <- rbind(table,temp_table)
temp_table
file.remove('temp.html')
# Tv show title
serie_title = 'Breaking Bad'
# Seasons
s = 5
# Tv show code
code = 'tt0903747'
# setup dataframe
table = data.frame()
for(i in 1:s){
url = paste0("https://www.imdb.com/title/",code,"/episodes?season=",i)
while(TRUE){
dl_file <- try(download.file(as.character(url), destfile = "temp.html", quiet=TRUE),
silent=TRUE)
if(!is(dl_file, 'try-error')) break
}
html_page <- read_html("temp.html")
saison = i
episode <- html_page %>%
html_nodes("#episodes_content strong a") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
note <- html_page %>%
html_nodes(".ipl-rating-star.small .ipl-rating-star__rating") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
vote <- html_page %>%
html_nodes(".ipl-rating-star__total-votes") %>%
html_text() %>%
str_replace_all("\t|\n|", "")
date <- html_page %>%
html_nodes(".airdate") %>%
html_text() %>%
str_replace_all("\t|\n|", "") %>%
dmy() %>%
as.character()
temp_table <- as.data.frame(cbind(saison, episode, note, vote, date))
table <- rbind(table,temp_table)
file.remove('temp.html')
}
nb.cols <- s
mycolors <- colorRampPalette(brewer.pal(8, "Paired"))(nb.cols)
df_avg %>%
ggplot(aes(episode_mod, note)) +
geom_hline(
data = tibble(y = 7:11),
aes(yintercept = y),
color = "grey82",
size = .5
) +
geom_segment(aes(
xend = episode_mod,
yend = avg,
color = saison,
color = after_scale(colorspace::lighten(color, .2))
)) +
geom_line(data = df_lines,
aes(
x_group,
y,
color = saison,
color = after_scale(colorspace::darken(color, .2))
),
size = 2.5) +
geom_point(aes(size = vote,
color = saison)) +
geom_label(
aes(
mid,
10.2,
label = glue::glue(" Saison {saison} "),
color = saison,
color = after_scale(colorspace::darken(color, .2))
),
show.legend = FALSE,
fill = NA,
label.padding = unit(.2, "lines"),
label.r = unit(.25, "lines"),
label.size = .5
)  +
scale_x_continuous(expand = c(.015, .015)) +
scale_y_continuous(
expand = c(.03, .03),
limits = c(6.5, 10.5),
breaks = seq(6.5, 10, by = .5),
sec.axis = dup_axis(name = NULL)
) +
scale_color_manual(values = mycolors, guide = "none") +
scale_size_binned(
name = "Votes per episode",
range = c(.3, 6),
labels = function(x)
format(x, big.mark = " ", scientific = FALSE)
) +
ggtitle(serie_title) +
labs(x = "", y = "Rating",
caption = "Visualization by Cl√©ment Rieux") +
guides(
size = guide_bins(
show.limits = T,
direction = "horizontal",
title.position = "top",
title.hjust = .5
)
) +
theme(
legend.position = c(.2, .085),
legend.key.size = unit(1, 'cm'),
legend.key.width = unit(2, "lines"),
legend.text = element_text(
angle = 60,
vjust = 1,
hjust = 1
),
axis.ticks.x = element_blank(),
axis.text.x = element_blank()
)
df_avg
df_avg <-
table %>%
group_by(saison) %>%
mutate(episode = row_number(),
saison = as.numeric(saison),
note = as.numeric(note),
vote = gsub(',','',vote),
vote = as.numeric(gsub("[^\\d]+", "", vote, perl=TRUE))
) %>%
ungroup() %>%
arrange(saison, episode) %>%
mutate(episode_id = row_number()) %>%
group_by(saison) %>%
mutate(
avg = mean(note),
episode_mod = episode_id + (9 * saison),
mid = mean(episode_mod)
) %>%
ungroup() %>%
mutate(saison = factor(saison))
df_avg
df_avg %>%
ggplot(aes(x = date, y = vote)) +
geom_point()
df_avg %>%
ggplot(aes(x = date, y = note)) +
geom_point()
df_avg %>%
ggplot(aes(x = date, y = note, fill = note)) +
geom_point()
df_avg %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point()
df_avg %>%
mutate(date = as.Date(date)) +
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "1 month",
date_labels = "%B-%Y")
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "1 month",
date_labels = "%B-%Y")
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "1 month", date_labels = "%B-%Y") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "1 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=1.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=-1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=-0.1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust=0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = -0.5, hjust=0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = +0.5, hjust=0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = +0.5, hjust=0.6))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = +0.5, hjust=0.3))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = +0.6, hjust=0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = +0.2, hjust=0.5))
margin_spacer <- function(x) {
# where x is the column in your dataset
left_length <- nchar(levels(factor(x)))[1]
if (left_length > 8) {
return((left_length - 8) * 4)
}
else
return(0)
}
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = -1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, vjust = -0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = -0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 0.5))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 0.8))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1, vjust = 0.1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1, vjust = 0.001))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1, vjust = -0.001))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1, vjust = -1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
theme_void()
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
theme_classic(base_size = 25)
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme(axis.text.x = element_text(angle = 70, hjust = 1)) +
theme_classic()
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme_classic() +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_colour_gradient2() +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme_classic() +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_colour_gradient(low = "red", high = "green", na.value = NA)
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme_classic() +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_colour_gradient(low = "#96341B", high = "#2B940A", na.value = NA)
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme_classic() +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_colour_gradient(low = "#96341B", high = "#3CDE0B", na.value = NA)
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_colour_gradient(low = "#E84D23", high = "#3CDE0B", na.value = NA)
df_avg %>%
mutate(date = as.Date(date)) %>%
ggplot(aes(x = date, y = note, color = note)) +
geom_point() +
scale_colour_gradient(low = "#E84D23", high = "#3CDE0B", na.value = NA) +
scale_x_date(date_breaks = "3 month", date_labels = "%b-%Y") +
theme_classic() +
theme(axis.text.x = element_text(angle = 70, hjust = 1))
library(gptstudio)
trace(addin_comment_code, edit = T)
reticulate::repl_python()
library(dplyr)
df = data("starwars")
reticulate::repl_python()
